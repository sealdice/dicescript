## 更新记录

#### 2025.10.14
* 新增自定义算符 `CustomDiceStream` 流式解析能力，可在回调中逐字符消费输入、读取表达式并携带 payload，示例与测试同步更新。

#### 2025.10.10
* 新增自定义算符(正则模式)注册与 dice.custom 字节码，实现正则匹配驱动的回调并可自定义 detail 输出。
* Shell 示例添加阶乘与组合算符演示，并扩充测试覆盖自定义算符路径。

#### 2025.9.3
* Context 增加 CustomFlag 状态并在子 VM 之间共享，同时 detail 文本自动去除首尾空白。

#### 2025.8.31
* 统一变量读取流程，LoadName/LoadNameWithDetail 支持 raw 模式并补齐 load detail 标记。
* 钩子接口重命名为 HookValueLoadPre/HookValueLoadPost，并新增 CustomDetailRewriteFunc 方便重写计算过程片段。

#### 2025.8.19
* 修复未闭合函数调用触发的 a(a 解析问题，保证 RestInput 与 detail 输出符合核心项目 #1371 的预期。

#### 2025.8.17
* 调整 jsport 工作流以裁剪 gh-pages 产物并修复测试页加载。

#### 2024.9.27
* CustomMakeDetailFunc 回调新增 parsedOffset 参数，便于按源文本偏移自定义过程字符串。

#### 2024.9.7
* 修复大面骰概率偏移并让计算类型能获取完整的中间过程 detail。
* 修正 GopherJS 编译失败的问题。
* 重构随机数生成逻辑以统一取值。

#### 2024.8.17
* 新增内置函数 store，变量尾缀允许使用 【】（） 等字符以兼容旧写法。

#### 2024.8.8
* while/if 语句块执行后自动恢复栈状态，相关文档与 detail 逻辑同步更新。

#### 2024.8.4
* fstring 的 {} 现在可直接书写复杂语句，相当于 {% %} 的别名。

#### 2024.7.19
* 新增 load 回调类型与内置函数 typeId、Computed.compute 以及 loadRaw，扩展动态载入能力。
* 重写 HookFuncValueLoadOverwrite 流程，提升自定义加载覆盖的一致性。

#### 2024.7.11
* 修复 HookFuncValueLoadOverwrite 误判 detail 为空导致的崩溃问题。

#### 2024.7.3
* 钩子接口补充 ctx 参数，回调可以访问当前上下文。

#### 2024.7.2
* 实现 d 优势语法并支持骰子上下界配置。
* 改进计算过程输出与相关测试，文档同步更新。

#### 2024.6.23
* 重写计算过程机制
* 改进st兼容问题

#### 2024.6.18
* round ceil floor 允许输入int类型
* 加入新函数load用于动态载入变量
* 重新整理文档

#### 2024.6.16
* 重写了字符串解析并修复换行和换行转义混用解析错误的bug
* 计算类型内部储存的值现在支持被序列化

#### 2024.6.11
* 字符串模板中的 {% %} 不再输出内容
* 字符串模板 {} 报错优化
* 计算过程信息进行算符标注
* 优化值读写钩子接口

#### 2024.6.8
* 赋值语句调整为表达式，这意味着能够在字符串模板中使用
* 赋值语句取值后不再从栈中弹出值
* 新增报错信息优化方案

#### 2024.6.5
* 随机种子设置，序列化和反序列
* 计算过程文本可以自定义了
* 计算过程文本的生成函数进行了分离，现在只在GetDetailText被调用时生成
* 将解析和执行分成两个阶段，可以分别单独调用
* 现在能够检查生成的字节码是否进行了骰点运算，这在部分指令中很有用

#### 2024.6.3
* 修改API，新建变量更为简洁
* 移除了undefined
* 修复了ToJSON的一个bug

#### 2024.5.12
* 使用 [自己修改的 pigeon](https://github.com/fy0/pigeon) 重构语法解析

#### 2023.9.15
* NativeObject 一种用于绑定Go对象的类型，行为类似于dict
* 为字典类型增加了 keys() values() items() 方法
* dir 函数，和python的dir函数类似，用于获取对象的所有属性

#### 2023.10.22
* 空值合并算符
* 文档调整

#### 2022.11.29

* 逻辑与/逻辑或/按位与/按位或
* 补全测试用例
* 编写文档

#### 2022.11.28

* Fate/WoD/DoubleCross 相关算符
* 计算过程完善


#### 2022.11.24

* 内置函数支持默认参数
* 简易原型链机制


#### 2022.11.23

* 计算过程显示


#### 2022.11.20

* 字典类型


#### 2022.11.18

* 变量作用域


#### 2022.9.17

* 序列化和反序列化: array native_function，全类型完成


#### 2022.9.12

* 内置函数: ceil floor round int float str
* 序列化和反序列化: int float str undefined null computed function


#### 2022.9.10

* 分片赋值，以及取值语法，支持array和str
* range语法 \[0..2] 为 \[0,1,2]，\[3..1] 为 \[3,2,1]

#### 2022.9.8

* while 语法
* return 语法
* 数组下标赋值
* 线程安全优化
* 现在可以使用 true / false 其值为 1 / 0
* break / continue 支持

#### 2022.9.4

* 多维数组
* computed 计算类型
* function 函数类型

#### 2022.9.3

* if else 语句
* undefined 类型
* a == 1 ? 1 : 2 三目运算符
* a == 1 ? 'A', a == 2 ? 'B', a == 3 : 'C'
* 一元算符 +1 -1
* 数组
* 数组下标
* fvtt语法: \[1,2,3]kh   \[1,2,3]kl

#### 2022.9.2

* 支持浮点数
* 支持字符串
* 支持变量
* RollVM的测试覆盖率提升至95%
* 能够编译到JS

#### 2022.9.1

* 数学和逻辑算符全类型支持(除computed和array之外)
* 初步的单元测试
* 异常机制
* 接口调整
* 实现了d算符
* 实现d算符语法，d20k / d20q / d20kh / d20hl / d20d / d20dl / d20dh

#### 2022.8.30

* 二元算符框架(+-*/等)
* 支持数学四则运算
* 支持比较算符(< <= == != > >=)

#### 2022.8.29

* 指令执行初步架构
* VM接口
* 简易REPL

#### 2022.8.25

* 建项目，初步文法
